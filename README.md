# ✂️ CutOnly - カット検出・解析ツール

CutOnly は PySceneDetect を用いて動画のカット境界を抽出し、Web UI 上で結果を視覚的に確認できる Python アプリケーションです。新しい UI は FastAPI + Jinja2 によるシングルページ構成で、動画の再生タイムラインと検出結果が同期するようになりました。

---

## ✨ 主な機能

- **シーン検出**: Content / Adaptive / Threshold の 3 種類の検出モードをサポート。
- **タイムライン連携**: 動画を再生するとタイムライン上のマーカーとカット詳細が自動で切り替わります。
- **インタラクティブ操作**: タイムラインやプルダウンから任意のカットを選ぶと、その位置へジャンプし再生できます。
- **カット一覧とダウンロード**: 検出結果をテーブル表示し、JSON としてダウンロード可能。
- **YouTube 対応**: URL を入力すると動画を一時的に取得して解析します。

---

## 🛠 使用技術

- **バックエンド**: FastAPI, PySceneDetect, OpenCV
- **テンプレート**: Jinja2 + 自前の JavaScript / CSS
- **その他**: pytube による YouTube ダウンロード

---

## ⚙ 動作環境

- Python 3.9 以上
- `pip` が利用可能な環境
- FFmpeg などの追加インストールは不要（PySceneDetect が内部で処理します）

---

## 🚀 セットアップ手順

1. リポジトリを取得し、任意のディレクトリに移動します。

   ```bash
   git clone https://github.com/your-username/cutonly.git
   cd cutonly
   ```

2. 仮想環境を作成し、有効化します（任意）。

   ```bash
   python -m venv .venv
   # Windows
   .venv\Scripts\activate
   # macOS / Linux
   source .venv/bin/activate
   ```

3. 依存関係をインストールします。

   ```bash
   pip install -r requirements.txt
   ```

4. アプリケーションを起動します。

   ```bash
   uvicorn cut_detector:app --reload
   ```

5. ブラウザで `http://127.0.0.1:8000` にアクセスします。

---

## 📄 使い方

1. 左側のフォームで次のいずれかを行います。
   - 動画ファイルをアップロード（MP4 / MOV / MKV / AVI / WEBM）。
   - または YouTube の動画リンクを入力。
2. 検出モードと最小カット長（フレーム数）を指定し、**「検出を実行」** を押します。
3. 解析が完了すると、右側に動画プレイヤーとカット情報が表示されます。
   - 再生すると、タイムラインのマーカーと詳細パネルが自動で切り替わります。
   - タイムラインまたはセレクトボックスから任意のカットを選択すると、その位置から再生が始まります。
4. カット一覧テーブルの上部にある **「JSONで保存」** リンクから、解析結果をダウンロードできます。

---

## 🧰 トラブルシューティング

- **YouTube の解析に失敗する**: 再生制限のある動画やライブ配信は取得できない場合があります。別の動画でお試しください。
- **長時間動画で時間がかかる**: 最小カット長を長めに設定すると、不要な検出を減らし、処理時間を短縮できます。
- **動画が再生されない**: ブラウザで動画形式に対応しているか、またはアップロードファイルが破損していないか確認してください。

---

## 🤝 コントリビュート

バグ報告や機能リクエストは Issue で、修正や改善は Pull Request でお知らせください。UI アイデアの提案も歓迎です。

---

## 📄 ライセンス

本プロジェクトは MIT License で提供されています。詳細は `LICENSE` を参照してください。
